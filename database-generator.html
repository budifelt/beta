<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Campaign File Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>

<style id="theme-overrides">
:root{
  --bg1:#3940b8; --bg2:#5a3f8f;
  --surface:#0b1220; --surface-elev:#111827;
  --text:#e5e7eb; --text-strong:#f3f4f6; --muted:#9aa4b2;
  --ring:#7c89ff; --glow1:#667eea; --glow2:#764ba2;
  --radius:16px; --space:clamp(14px,2vw,24px); --container:1100px;
  --shadow:0 10px 28px rgba(0,0,0,.30);
  --shadow-lg:0 22px 60px rgba(20,30,60,.45);
}
/* Base */
html,body{height:100%}
body{
  color:var(--text) !important;
  background: linear-gradient(135deg, var(--bg1), var(--bg2)) !important;
  font-family: ui-sans-serif, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, Arial, sans-serif !important;
}
/* Common containers */
.container, #mainContent, .calendar, .counter-container, .instructions, .history-container,
#sidebar, #fileList, #databaseContent, #resultsContainer, #krhredResults, #krhredDetails,
#contentContainer, #editor, textarea, input[type="text"], input[type="search"], select, .virtual-scroll-container {
  background: var(--surface) !important;
  color: var(--text) !important;
  border-color: rgba(255,255,255,.08) !important;
  box-shadow: var(--shadow);
}
/* Cards/panels subtle elevation */
.container, .calendar, .counter-container, #mainContent, .instructions, .history-container{
  border-radius: var(--radius);
  position: relative;
  overflow: hidden;
}
.container::after, .calendar::after, .counter-container::after, #mainContent::after {
  content:""; position:absolute; inset:-2px; border-radius:inherit;
  background:linear-gradient(45deg,var(--glow1),var(--glow2));
  opacity:.18; pointer-events:none; mix-blend-mode:screen;
}
/* Headings & text */
h1,h2,h3,h4,h5 { color: var(--text-strong) !important; }
p, label, .sync-status, .last-updated, .text-slate-400 { color: var(--muted) !important; }
/* Buttons */
button, .bookmarklet {
  background: var(--surface-elev) !important;
  color: var(--text) !important;
  border:1.5px solid rgba(255,255,255,.08) !important;
  border-radius: var(--radius) !important;
  box-shadow: var(--shadow);
  transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
}
button:hover, .bookmarklet:hover {
  transform: translateY(-2px);
  background:#0f172a !important;
  border-color: rgba(124,137,255,.55) !important;
  box-shadow: var(--shadow-lg);
}
/* Links */
a { color: #9bb1ff !important; }
/* Inputs & textareas */
input, textarea, select {
  border-radius: var(--radius) !important;
  background: #0f172a !important;
  color: var(--text) !important;
  border:1px solid rgba(255,255,255,.10) !important;
}
input::placeholder, textarea::placeholder { color: #9aa4b2 !important; }
/* Tables */
table { color: var(--text) !important; }
th, td { border-color: rgba(255,255,255,.10) !important; }
thead { background: #0f172a !important; }
/* Specific elements in provided files */
/* Database Checker */
#databaseContent { background:#0f172a !important; }
#krhredResults, #krhredDetails { background:#111827 !important; }
/* WFH Tracker calendar day colors */
.day.today { background:#64ffda !important; color:#0a192f !important; }
.day.wfh { background:#4caf50 !important; color:#fff !important; }
.day.other { background:#ff9800 !important; color:#fff !important; }
.day.weekend { background:#ef4444 !important; color:#fff !important; }
/* Bookmarklet page container */
body > .container { background: var(--surface) !important; }
/* Counter */
.buttons button:disabled { opacity:.5 !important; }
/* Scroll containers borders subtle */
#sidebar, #fileList { box-shadow: none !important; }
/* Keep selection visible */
::selection { background: rgba(124,137,255,.35); color:#fff; }
</style>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <main class="max-w-6xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">Campaign File Generator</h1>
      <p class="text-slate-400 mt-1">
        Masukkan <span class="font-mono">Campaign ID</span> (wajib diawali <strong>YYYYMMDD</strong>, sisanya bebas) & email â†’ generate 4 file .txt:
        <span class="font-mono">CustMast</span>, <span class="font-mono">CustPref</span>, <span class="font-mono">CustSubs</span>, <span class="font-mono">CustAttr</span>.
      </p>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
      <div class="md:col-span-2">
        <label class="text-sm text-slate-300">Campaign ID</label>
        <input id="campaignId" class="mt-1 w-full rounded-2xl bg-slate-900 border border-slate-700 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono" placeholder="YYYYMMDD_nama_bebas" spellcheck="false" />
        <p class="text-xs mt-1 text-slate-400">Contoh: <span class="font-mono">20250817_Independence-Day_1700</span></p>
      </div>
    </section>

    <!-- PANEL: EMAIL + KRHRED (tanpa switch; dynamic jika ada â‰¥1 kolom KRHRED) -->
    <section id="krPanel" class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4 mb-6">
      <div class="flex flex-wrap items-end gap-3 mb-4">
        <div class="flex items-end gap-3 grow">
          <div class="grow">
            <label class="text-sm text-slate-300">Tambah Email</label>
            <input id="newEmail" class="mt-1 w-full rounded-2xl bg-slate-900 border border-slate-700 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="email@contoh.com"/>
          </div>
          <button id="addEmail" class="px-4 py-2 rounded-2xl bg-emerald-600 hover:bg-emerald-500">Tambah email</button>
        </div>
        <div class="flex items-end gap-3">
          <div>
            <label class="text-sm text-slate-300">Tambah kolom KRHRED</label>
            <input id="newKey" class="mt-1 w-56 rounded-2xl bg-slate-900 border border-slate-700 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono" placeholder="KRHRED_Unit_30"/>
            <p class="text-[11px] text-slate-400 mt-1">Kosongkan untuk auto: <span class="font-mono">KRHRED_Unit_N</span> berikutnya.</p>
          </div>
          <button id="addKey" class="px-4 py-2 rounded-2xl bg-indigo-600 hover:bg-indigo-500">Tambah kolom</button>
        </div>

        <!-- tombol buka panel bulk -->
        <div>
          <button id="bulkBtn" class="px-4 py-2 rounded-2xl bg-slate-800 hover:bg-slate-700">Tempel banyak email</button>
        </div>
      </div>

      <!-- panel bulk -->
      <div id="bulkBox" class="hidden mb-4">
        <label class="text-sm text-slate-300">Tempel banyak email (pisahkan dengan baris/koma/titik koma/spasi)</label>
        <textarea id="bulkEmails" class="mt-1 w-full rounded-2xl bg-slate-900 border border-slate-700 px-4 py-3 h-28 resize-y focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono" placeholder="email1@a.com&#10;email2@a.com, email3@a.com; email4@a.com"></textarea>
        <div class="flex gap-3 mt-2">
          <button id="applyBulk" class="px-4 py-2 rounded-2xl bg-emerald-600 hover:bg-emerald-500">Tambahkan</button>
          <button id="cancelBulk" class="px-4 py-2 rounded-2xl bg-slate-800 hover:bg-slate-700">Batal</button>
        </div>
        <p id="bulkInfo" class="text-xs text-slate-400 mt-2"></p>
      </div>

      <div class="text-xs text-slate-400 mb-2 flex items-center gap-3">
        <span id="countInfo">Total: 0</span>
        <span id="invalidInfo" class="hidden text-rose-400"></span>
      </div>

      <div class="overflow-auto">
        <table class="min-w-full text-sm">
          <thead>
            <tr id="krHeadRow">
              <th class="text-left px-3 py-2 sticky left-0 bg-slate-900/80 backdrop-blur border-b border-slate-800">Email</th>
              <!-- dynamic head cells here -->
            </tr>
          </thead>
          <tbody id="krBody"></tbody>
        </table>
      </div>

      <div class="text-xs text-slate-400 mt-3">
        <p>Tips: klik ikon âœ• di header kolom untuk menghapus kolom KRHRED. Klik ðŸ—‘ di baris untuk menghapus email.</p>
      </div>
    </section>

    <div class="flex flex-wrap items-center gap-3 mb-2">
      <button id="btnDownload" class="px-4 py-2 rounded-2xl shadow bg-indigo-600 hover:bg-indigo-500 disabled:opacity-40" disabled>
        Download 4 file
      </button>
      <button id="btnSave" class="px-4 py-2 rounded-2xl shadow bg-emerald-600 hover:bg-emerald-500 disabled:opacity-40" disabled>
        Save to folder
      </button>
      <span id="stateMsg" class="text-xs text-slate-400"></span>
    </div>

    <p id="error" class="text-amber-300 text-sm mb-4 hidden"></p>

    <section id="previews" class="grid grid-cols-1 md:grid-cols-2 gap-4"></section>

    <!-- Fallback links jika auto-download diblok -->
    <section id="dlSection" class="mt-4 hidden">
      <h3 class="text-sm text-slate-300 mb-2">Unduhan manual (fallback)</h3>
      <div id="downloadsList" class="flex flex-col gap-2"></div>
      <p class="text-xs text-slate-400 mt-2">Jika auto-download tidak berjalan, klik link di atas satu per satu.</p>
    </section>

    <footer class="mt-6 text-xs text-slate-400">
      <p>Catatan: "Save to folder" memakai File System Access API (tersedia di Chrome/Edge desktop). Jika tidak didukung, gunakan tombol <em>Download 4 file</em> atau link fallback.</p>
    </footer>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const campaignRegex = /^\d{8}.*$/; // Wajib diawali 8 digit angka (YYYYMMDD)

    const campaignIdEl = $('#campaignId');

    // Email/KR elements
    const newEmailEl = $('#newEmail');
    const addEmailBtn = $('#addEmail');

    // BULK refs
    const bulkBtn = $('#bulkBtn');
    const bulkBox = $('#bulkBox');
    const bulkEmailsEl = $('#bulkEmails');
    const applyBulkBtn = $('#applyBulk');
    const cancelBulkBtn = $('#cancelBulk');
    const bulkInfo = $('#bulkInfo');

    const newKeyEl = $('#newKey');
    const addKeyBtn = $('#addKey');
    const krHeadRow = $('#krHeadRow');
    const krBody = $('#krBody');

    const btnDownload = $('#btnDownload');
    const btnSave = $('#btnSave');
    const stateMsg = $('#stateMsg');
    const errorEl = $('#error');
    const previewsEl = $('#previews');
    const countInfo = $('#countInfo');
    const invalidInfo = $('#invalidInfo');

    const dlSection = $('#dlSection');
    const downloadsList = $('#downloadsList');

    // State
    let emails = [];                 // ["a@a.com", ...]
    let krKeys = [];                 // ["KRHRED_Unit_30", ...]
    const krValues = new Map();      // email -> Map(key -> value)

    // ---------- Helpers ----------
    function parseManyEmails(text) {
      const raw = (text || '')
        .split(/[\n,;\s]+/)        // baris, koma, titik koma, spasi
        .map(s => s.trim())
        .filter(Boolean);
      const out = [];
      const seen = new Set(emails);  // hindari duplikat dgn existing
      for (const e of raw) {
        if (!seen.has(e)) { out.push(e); seen.add(e); }
      }
      return out;
    }

    function normalizeKey(k) {
      if (k && k.trim()) {
        let key = k.trim();
        if (!/^KRHRED_/i.test(key)) key = 'KRHRED_' + key;
        key = key.replace(/\s+/g, '_');
        return key;
      }
      // auto-generate KRHRED_Unit_N starting at 30
      const nums = krKeys
        .map(x => (/KRHRED_Unit_(\d+)/i.exec(x)?.[1]))
        .filter(Boolean)
        .map(n => parseInt(n, 10));
      const max = nums.length ? Math.max(...nums) : 29;
      return `KRHRED_Unit_${max + 1}`;
    }

    function ensureRowMap(email) {
      if (!krValues.has(email)) krValues.set(email, new Map());
      return krValues.get(email);
    }

    function migrateEmail(oldEmail, newEmail) {
      if (oldEmail === newEmail) return;
      if (!emailRegex.test(newEmail)) return; // ignore invalid sampai valid
      if (emails.includes(newEmail)) return; // hindari duplikat
      const map = krValues.get(oldEmail) || new Map();
      krValues.delete(oldEmail);
      krValues.set(newEmail, map);
      emails = emails.map(e => (e === oldEmail ? newEmail : e));
      renderTable();
      updateUI();
    }

    function removeEmailRow(email) {
      emails = emails.filter(e => e !== email);
      krValues.delete(email);
      renderTable();
      updateUI();
    }

    function renderTable() {
      // Header: hapus kolom KR lama
      krHeadRow.querySelectorAll('th[data-key]').forEach(th => th.remove());
      for (const key of krKeys) {
        const th = document.createElement('th');
        th.className = 'px-2 py-2 border-b border-slate-800 whitespace-nowrap';
        th.setAttribute('data-key', key);
        th.innerHTML = `
          <div class="flex items-center gap-2">
            <span class="font-mono">${key}</span>
            <button class="text-slate-400 hover:text-rose-400" title="Hapus kolom" data-remove-key="${key}">âœ•</button>
          </div>`;
        krHeadRow.appendChild(th);
      }

      // Body
      krBody.innerHTML = '';
      for (const email of emails) {
        const tr = document.createElement('tr');

        const tdEmail = document.createElement('td');
        tdEmail.className = 'px-3 py-2 sticky left-0 bg-slate-900/80 backdrop-blur border-b border-slate-800';
        tdEmail.innerHTML = `
          <div class="flex items-center gap-2">
            <input class="w-64 md:w-72 rounded-xl bg-slate-900 border border-slate-700 px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500" value="${email}" />
            <button class="text-slate-400 hover:text-rose-400" title="Hapus email" data-remove-email="${email}">ðŸ—‘</button>
          </div>`;
        tr.appendChild(tdEmail);

        const rowMap = ensureRowMap(email);
        for (const key of krKeys) {
          const td = document.createElement('td');
          td.className = 'px-2 py-2 border-b border-slate-800';
          const inp = document.createElement('input');
          inp.className = 'w-44 md:w-56 rounded-xl bg-slate-900 border border-slate-700 px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500';
          inp.value = rowMap.get(key) ?? '';
          inp.placeholder = 'nilai';
          inp.addEventListener('input', () => { rowMap.set(key, inp.value); updateUI(); });
          td.appendChild(inp);
          tr.appendChild(td);
        }
        krBody.appendChild(tr);

        // email change listener
        const emailInput = tdEmail.querySelector('input');
        emailInput.addEventListener('change', () => migrateEmail(email, emailInput.value.trim()));
      }

      // Listeners: remove email / remove key
      krHeadRow.querySelectorAll('button[data-remove-key]').forEach(btn => {
        btn.addEventListener('click', () => {
          const k = btn.getAttribute('data-remove-key');
          krKeys = krKeys.filter(x => x !== k);
          for (const m of krValues.values()) m.delete(k);
          renderTable();
          updateUI();
        });
      });
      krBody.querySelectorAll('button[data-remove-email]').forEach(btn => {
        btn.addEventListener('click', () => removeEmailRow(btn.getAttribute('data-remove-email')));
      });
    }

    function recordId(campaignId, i) { return `${campaignId}-${String(i + 1).padStart(6, '0')}`; }
    function rowCustMast(id, email) { const emptyCount = 17; const empties = Array(emptyCount).fill('').join('|'); return `${id}|${email}|${empties}|\n`; }
    function rowCustPref(id, email, campaignId) { return `${id}|${email}|CMPG_ID|${campaignId}|\n`; }
    function rowCustSubs(id, email) { return `${id}|${email}|IMO Marketing|Y|\n`; }
    function rowsCustAttrStatic(id, email, campaignId) { return `${id}|${email}|CMPG_ID|${campaignId}|\n`; }
    function rowsCustAttrDynamic(id, email, campaignId) {
      let out = `${id}|${email}|CMPG_ID|${campaignId}|\n`;
      const rowMap = krValues.get(email) || new Map();
      for (const key of krKeys) { const val = rowMap.get(key) ?? ''; out += `${id}|${email}|${key}|${val}|\n`; }
      return out;
    }

    function buildAllFiles(campaignId, emailList, useKr) {
      let mast = '', pref = '', subs = '', attr = '';
      emailList.forEach((email, i) => {
        const id = recordId(campaignId, i);
        mast += rowCustMast(id, email);
        pref += rowCustPref(id, email, campaignId);
        subs += rowCustSubs(id, email);
        attr += useKr ? rowsCustAttrDynamic(id, email, campaignId) : rowsCustAttrStatic(id, email, campaignId);
      });
      return {
        [`${campaignId}-CustMast.txt`]: mast,
        [`${campaignId}-CustPref.txt`]: pref,
        [`${campaignId}-CustSubs.txt`]: subs,
        [`${campaignId}-CustAttr.txt`]: attr,
      };
    }

    function downloadText(name, content) {
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = name;
      document.body.appendChild(a);
      setTimeout(() => {
        a.click();
        setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 0);
      }, 0);
    }

    function renderDownloadLinks(files) {
      downloadsList.innerHTML = '';
      for (const [name, content] of Object.entries(files)) {
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = name;
        a.textContent = `â¬‡ï¸ ${name}`;
        a.className = 'inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 w-fit';
        downloadsList.appendChild(a);
        // revoke setelah 2 menit (link cukup lama untuk di-klik)
        setTimeout(() => { URL.revokeObjectURL(url); a.removeAttribute('href'); a.classList.add('opacity-50','pointer-events-none'); }, 120000);
      }
      dlSection.classList.remove('hidden');
    }

    async function saveAllToFolder(files) {
      errorEl.classList.add('hidden');
      try {
        if (!('showDirectoryPicker' in window)) throw new Error("Browser Anda tidak mendukung 'Save to folder'. Coba Chrome/Edge desktop.");
        const dirHandle = await window.showDirectoryPicker({ mode: 'readwrite' });
        for (const [name, content] of Object.entries(files)) {
          const fileHandle = await dirHandle.getFileHandle(name, { create: true });
          const writable = await fileHandle.createWritable();
          await writable.write(content);
          await writable.close();
        }
      } catch (e) {
        if (e && e.name === 'AbortError') return;
        errorEl.textContent = e?.message || 'Gagal menyimpan ke folder.';
        errorEl.classList.remove('hidden');
      }
    }

    function updateUI() {
      const campaignId = campaignIdEl.value.trim();
      const useKr = krKeys.length > 0;

      // Stats & validation
      const invalid = emails.filter(e => !emailRegex.test(e));
      countInfo.textContent = `Total: ${emails.length}`;
      if (invalid.length) {
        invalidInfo.textContent = `Invalid: ${invalid.slice(0,3).join(', ')}${invalid.length>3?', â€¦':''}`;
        invalidInfo.classList.remove('hidden');
      } else {
        invalidInfo.classList.add('hidden');
      }

      const ok = campaignRegex.test(campaignId) && emails.length > 0 && invalid.length === 0;
      btnDownload.disabled = !ok;
      btnSave.disabled = !ok;

      stateMsg.textContent = ok
        ? ''
        : (!campaignRegex.test(campaignId)
            ? 'Isi Campaign ID diawali YYYYMMDD.'
            : 'Tambahkan minimal 1 email valid.');

      // Previews
      previewsEl.innerHTML = '';
      if (!ok) return;
      const show = Math.min(emails.length, 5);
      const ids = Array.from({length: show}, (_, i) => recordId(campaignId, i));
      const sample = emails.slice(0, show);
      const previews = {
        [`${campaignId}-CustMast.txt`]: sample.map((e,i)=>rowCustMast(ids[i], e)).join('') + (emails.length>show?'â€¦\n':''),
        [`${campaignId}-CustPref.txt`]: sample.map((e,i)=>rowCustPref(ids[i], e, campaignId)).join('') + (emails.length>show?'â€¦\n':''),
        [`${campaignId}-CustSubs.txt`]: sample.map((e,i)=>rowCustSubs(ids[i], e)).join('') + (emails.length>show?'â€¦\n':''),
        [`${campaignId}-CustAttr.txt`]: sample.map((e,i)=> (useKr ? rowsCustAttrDynamic(ids[i], e, campaignId) : rowsCustAttrStatic(ids[i], e, campaignId))).join('') + (emails.length>show?'â€¦\n':''),
      };
      for (const [name, content] of Object.entries(previews)) {
        const card = document.createElement('div');
        card.className = 'bg-slate-900 rounded-2xl shadow p-4';
        card.innerHTML = '<div class="flex items-center justify-between"><h3 class="font-medium text-slate-200 truncate pr-2">'+name+'</h3><span class="text-[10px] px-2 py-1 rounded-full bg-slate-800 border border-slate-700">preview</span></div><pre class="mt-3 text-sm overflow-auto max-h-40 whitespace-pre-wrap leading-relaxed font-mono text-slate-300"></pre>';
        card.querySelector('pre').textContent = content;
        previewsEl.appendChild(card);
      }
    }

    // --- Events ---
    addEmailBtn.addEventListener('click', () => {
      const v = (newEmailEl.value || '').trim();
      if (!v) return;
      if (!emailRegex.test(v)) return alert('Email tidak valid.');
      if (!emails.includes(v)) {
        emails.push(v);
        ensureRowMap(v);
        renderTable();
        updateUI();
      }
      newEmailEl.value = '';
    });

    // Bulk handlers
    bulkBtn.addEventListener('click', () => {
      bulkBox.classList.toggle('hidden');
      bulkInfo.textContent = '';
    });
    cancelBulkBtn.addEventListener('click', () => {
      bulkBox.classList.add('hidden');
      bulkEmailsEl.value = '';
      bulkInfo.textContent = '';
    });
    applyBulkBtn.addEventListener('click', () => {
      const list = parseManyEmails(bulkEmailsEl.value);
      const valid = [];
      const invalid = [];
      for (const e of list) {
        if (emailRegex.test(e)) valid.push(e);
        else invalid.push(e);
      }
      // tambah yang valid & belum ada
      for (const e of valid) {
        if (!emails.includes(e)) {
          emails.push(e);
          ensureRowMap(e);
        }
      }
      renderTable();
      updateUI();

      // info singkat
      const parts = [];
      if (valid.length) parts.push(`${valid.length} email ditambahkan`);
      if (invalid.length) parts.push(`${invalid.length} invalid (diabaikan)`);
      bulkInfo.textContent = parts.join(' â€¢ ') || 'Tidak ada email baru.';
      // tetap biarkan teks paste agar bisa diperbaiki lalu Tambahkan lagi
    });

    addKeyBtn.addEventListener('click', () => {
      const key = normalizeKey(newKeyEl.value);
      if (!krKeys.includes(key)) {
        krKeys.push(key);
        for (const email of emails) ensureRowMap(email).set(key, ensureRowMap(email).get(key) ?? '');
        newKeyEl.value = '';
        renderTable();
        updateUI();
      }
    });

    btnDownload.addEventListener('click', async () => {
      const campaignId = campaignIdEl.value.trim();
      const useKr = krKeys.length > 0;
      const files = buildAllFiles(campaignId, emails, useKr);
      // unduh berurutan + tampilkan fallback links
      for (const [name, content] of Object.entries(files)) {
        downloadText(name, content);
        await new Promise(r => setTimeout(r, 120));
      }
      renderDownloadLinks(files);
    });

    btnSave.addEventListener('click', async () => {
      const campaignId = campaignIdEl.value.trim();
      const useKr = krKeys.length > 0;
      const files = buildAllFiles(campaignId, emails, useKr);
      await saveAllToFolder(files);
    });

    campaignIdEl.addEventListener('input', updateUI);

    // Init empty table
    renderTable();
    updateUI();
  </script>

<!-- Tombol Back ke Index -->
<button class="back-btn" onclick="window.location.href='index.html'">âŒ‚</button>

<style>
.back-btn {
  position: fixed;
  top: 16px;
  right: 16px;
  background: #222;
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 42px;
  height: 42px;
  font-size: 20px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  transition: background 0.2s ease, transform 0.2s ease;
  z-index: 1000;
}
.back-btn:hover {
  background: #444;
  transform: scale(1.08);
}
</style>

</body>
</html>
