<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Night Sky Calendar</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #0a192f;
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .stars {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      overflow: hidden;
      z-index: -1;
    }

    .star {
      position: absolute;
      background: #fff;
      width: 2px;
      height: 2px;
      border-radius: 50%;
      animation: fall linear infinite;
    }

    @keyframes fall {
      0% {
        transform: translateY(-100%);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh);
        opacity: 0;
      }
    }

    .calendar {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      width: 400px; /* Changed from 340px to 400px */
      text-align: center;
      z-index: 1;
      transform: scale(1.3);
      transform-origin: center;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    .calendar-header button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }

    .calendar-header button:hover {
      transform: scale(1.2);
      opacity: 1;
    }

    .calendar-header button svg {
      width: 24px;
      height: 24px;
      fill: #64ffda;
      transition: fill 0.2s ease;
    }

    .calendar-header button:hover svg {
      fill: #ff9800;
    }

    .calendar h1 {
      margin: 0;
      font-size: 1.5rem;
      color: #fff;
    }

    .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .day {
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: transparent;
      user-select: none;
    }

    .day:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .day.today {
      background: #64ffda;
      color: #0a192f;
    }

    .day.wfh {
      background: #4caf50;
      color: #fff;
    }

    .day.other {
      background: #ff9800;
      color: #fff;
    }

    .day.weekend {
      background: #f44336;
      color: #fff;
      cursor: not-allowed;
    }
    .day.holiday {
      background: #f44336;
      color: #fff;
      cursor: pointer;
    }

    .day.empty {
      visibility: hidden;
    }

    .day-number {
      font-size: 1rem;
      font-weight: bold;
      user-select: none;
    }
    
    .day-name {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.7);
      user-select: none;
    }
    .day.weekend .day-name {
      color: #fff;
    }
    </style>
    <style>
      .day.other-month {
        opacity: 0.4;
        cursor: default;
      }
      .day.other-month:hover {
        background: transparent;
      }
    </style>
</head>
<body>
  <div class="stars" id="stars"></div>
  <div class="calendar">
  <div class="calendar-header">
      <button id="prev-month">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
        </svg>
      </button>
      <h1 id="month-year"></h1>
      <button id="next-month">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
        </svg>
      </button>
    </div>
    <div id="calendar-days" class="days"></div>
  </div>
  <div id="holiday-description" style="margin-top: 10px; color: #f44336; font-weight: bold; min-height: 24px;"></div>
  <script>
    const calendarDays = document.getElementById('calendar-days');
    const monthYear = document.getElementById('month-year');
    const prevMonthButton = document.getElementById('prev-month');
    const nextMonthButton = document.getElementById('next-month');
    const starsContainer = document.getElementById('stars');
    const holidayDescription = document.getElementById('holiday-description');

    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();

    const months = [
      'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
      'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
    ];

    const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];

    // Define holidays with date keys and descriptions
    const holidays = {
      // Format: 'YYYY-MM-DD': 'Holiday Description'
      '2024-01-01': 'Tahun Baru Masehi',
      '2024-02-10': 'Hari Raya Imlek',
      '2024-03-11': 'Hari Suci Nyepi',
      '2024-04-10': 'Wafat Isa Almasih',
      '2024-05-01': 'Hari Buruh Internasional',
      '2024-05-09': 'Kenaikan Yesus Kristus',
      '2024-05-23': 'Hari Raya Waisak',
      '2024-06-01': 'Hari Lahir Pancasila',
      '2024-06-17': 'Hari Raya Idul Fitri',
      '2024-08-17': 'Hari Kemerdekaan RI',
      '2024-11-01': 'Hari Raya Idul Adha',
      '2024-12-25': 'Hari Natal'
    };

    function createStars() {
      for (let i = 0; i < 50; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.animationDuration = `${Math.random() * 10 + 5}s`;
        starsContainer.appendChild(star);
      }
    }

    createStars();

    // IndexedDB utility functions
    function openDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open('CalendarDB', 1);
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          if (!db.objectStoreNames.contains('days')) {
            db.createObjectStore('days', { keyPath: 'date' });
          }
        };
        request.onsuccess = (event) => {
          resolve(event.target.result);
        };
        request.onerror = (event) => {
          reject(event.target.error);
        };
      });
    }

    function getDayState(db, date) {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(['days'], 'readonly');
        const store = transaction.objectStore('days');
        const request = store.get(date);
        request.onsuccess = () => {
          resolve(request.result ? request.result.state : null);
        };
        request.onerror = () => {
          reject(request.error);
        };
      });
    }

    function putDayState(db, date, state) {
      return new Promise((resolve, reject) => {
        const transaction = db.transaction(['days'], 'readwrite');
        const store = transaction.objectStore('days');
        if (state === null) {
          const deleteRequest = store.delete(date);
          deleteRequest.onsuccess = () => resolve();
          deleteRequest.onerror = () => reject(deleteRequest.error);
        } else {
          const request = store.put({ date, state });
          request.onsuccess = () => {
            resolve();
          };
          request.onerror = () => {
            reject(request.error);
          };
        }
      });
    }

    // Helper to format date as YYYY-MM-DD
    function formatDate(year, month, day) {
      const mm = (month + 1).toString().padStart(2, '0');
      const dd = day.toString().padStart(2, '0');
      return `${year}-${mm}-${dd}`;
    }

    async function renderCalendar(month, year) {
      const db = await openDB();

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDay = firstDay.getDay();

      monthYear.textContent = `${months[month]} ${year}`;
      calendarDays.innerHTML = '';

      // Add days from previous month
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      for (let i = startingDay - 1; i >= 0; i--) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('day', 'other-month');
        const dayNumber = document.createElement('div');
        dayNumber.classList.add('day-number');
        dayNumber.textContent = prevMonthLastDay - i;
        const dayName = document.createElement('div');
        dayName.classList.add('day-name');
        // Calculate day name for previous month day
        const prevMonthDate = new Date(year, month - 1, prevMonthLastDay - i);
        dayName.textContent = days[prevMonthDate.getDay()];
        dayElement.appendChild(dayNumber);
        dayElement.appendChild(dayName);
        calendarDays.appendChild(dayElement);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('day');

        const dayNumber = document.createElement('div');
        dayNumber.classList.add('day-number');
        dayNumber.textContent = day;

        const dayName = document.createElement('div');
        dayName.classList.add('day-name');
        const currentDate = new Date(year, month, day);
        dayName.textContent = days[currentDate.getDay()];

        dayElement.appendChild(dayNumber);
        dayElement.appendChild(dayName);

        const dateKey = formatDate(year, month, day);

        // Load saved state from IndexedDB and apply class
        const savedState = await getDayState(db, dateKey);
        let clickCount = 0;
        if (savedState === 'wfh') {
          dayElement.classList.add('wfh');
          clickCount = 1;
        } else if (savedState === 'other') {
          dayElement.classList.add('other');
          clickCount = 2;
        }

        if (currentDate.toDateString() === new Date().toDateString()) {
          dayElement.classList.add('today');
        }

        if (holidays[dateKey]) {
          dayElement.classList.add('holiday');
          dayElement.addEventListener('click', () => {
            holidayDescription.textContent = holidays[dateKey];
          });
        } else if (currentDate.getDay() === 0 || currentDate.getDay() === 6) {
          dayElement.classList.add('weekend');
        } else {
          dayElement.addEventListener('click', async () => {
            clickCount++;
            if (clickCount === 1) {
              dayElement.classList.remove('other');
              dayElement.classList.add('wfh');
              await putDayState(db, dateKey, 'wfh');
              holidayDescription.textContent = '';
            } else if (clickCount === 2) {
              dayElement.classList.remove('wfh');
              dayElement.classList.add('other');
              await putDayState(db, dateKey, 'other');
              holidayDescription.textContent = '';
            } else {
              dayElement.classList.remove('wfh', 'other');
              clickCount = 0;
              await putDayState(db, dateKey, null);
              holidayDescription.textContent = '';
            }
            // Update total WFO count display live on click
            updateTotalWfoCount();
          });
        }

        calendarDays.appendChild(dayElement);
      }

      const totalCells = startingDay + daysInMonth;
      const remainder = totalCells % 7;
      const emptyCellsNeeded = remainder === 0 ? 0 : 7 - remainder;

      // Add days from next month only if last week is incomplete
      for (let i = 1; i <= emptyCellsNeeded; i++) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('day', 'other-month');
        const dayNumber = document.createElement('div');
        dayNumber.classList.add('day-number');
        dayNumber.textContent = i;
        const dayName = document.createElement('div');
        dayName.classList.add('day-name');
        const nextMonthDate = new Date(year, month + 1, i);
        dayName.textContent = days[nextMonthDate.getDay()];
        dayElement.appendChild(dayNumber);
        dayElement.appendChild(dayName);
        calendarDays.appendChild(dayElement);
      }

      // Add total WFO count display below calendar
      let totalCountElement = document.getElementById('total-wfo-count');
      if (!totalCountElement) {
        totalCountElement = document.createElement('div');
        totalCountElement.id = 'total-wfo-count';
        totalCountElement.style.marginTop = '10px';
        totalCountElement.style.fontWeight = 'bold';
        totalCountElement.style.color = '#4caf50';
        calendarDays.parentNode.appendChild(totalCountElement);
      }
      // Update total count text
      const wfoDays = document.querySelectorAll('.day.wfh').length;
      totalCountElement.textContent = `Total WFO Days: ${wfoDays}`;
    }

    // Initialize total WFO count on page load
    function updateTotalWfoCount() {
      const totalCountElement = document.getElementById('total-wfo-count');
      if (!totalCountElement) return;
      const wfoDays = document.querySelectorAll('.day.wfh').length;
      totalCountElement.textContent = `Total WFO Days: ${wfoDays}`;
    }

    prevMonthButton.addEventListener('click', () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar(currentMonth, currentYear);
      holidayDescription.textContent = '';
    });

    nextMonthButton.addEventListener('click', () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentMonth, currentYear);
      holidayDescription.textContent = '';
    });

    renderCalendar(currentMonth, currentYear);
  </script>
</body>
</html>
