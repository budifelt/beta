<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Campaign Counter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #fff;
            --fg: #1e293b;
            --muted: #64748b;
            --border: #e2e8f0;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --card: #fafafa;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --radius: 16px;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-alt: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gradient);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background elements */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 20s infinite ease-in-out;
            z-index: -1;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.03"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.4;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* Tab Navigation */
        .login-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px 8px 0 0;
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tab-btn.active {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.3);
            color: white;
            transform: translateY(-2px);
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Login Modal without Overlay */
        .login-modal {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--radius);
            padding: 32px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 120px rgba(102,126,234,0.6);
            position: relative;
            overflow: hidden;
            transform: scale(1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0 auto;
        }

        .login-modal.active {
            transform: scale(1);
        }

        .login-modal h2 {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 24px;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* Modern Form Inputs */
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: white;
            margin-bottom: 8px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 15px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(255,255,255,0.2);
            box-shadow: 0 0 0 4px rgba(59,130,246,0.3);
            transform: translateY(-2px);
        }

        .form-group input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        /* Checkbox Styles */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .checkbox-label input[type="checkbox"]:checked {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* Create User Button */
        .create-user-btn {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255,255,255,0.05);
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .create-user-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,255,255,0.2);
        }

        /* Modern Buttons with Glassmorphism */
        .login-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .login-btn-primary {
            flex: 1;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59,130,246,0.4);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .login-btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .login-btn-primary:hover::before {
            left: 100%;
        }

        .login-btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(59,130,246,0.6);
        }

        .login-btn-secondary {
            flex: 1;
            padding: 16px 24px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .login-btn-secondary:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255,255,255,0.3);
        }

        /* Activation Modal Overlay */
        .login-modal-overlay {
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .login-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 9998;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            max-width: 90%;
            text-align: center;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toast::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-right: 10px;
        }

        .toast::after {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-left: 10px;
        }

        .toast.sms-sent {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        }

        .toast.sms-sent::before {
            content: 'üì±';
            position: absolute;
            top: -10px;
            left: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-right: 10px;
        }

        .toast.sms-sent::after {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-left: 10px;
        }

        .toast.activation-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        }

        .toast.activation-success::before {
            content: '‚úÖ';
            position: absolute;
            top: -10px;
            left: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-right: 10px;
        }

        .toast.activation-success::after {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-left: 10px;
        }

        .toast.error {
            background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%);
            border-color: #991b1b;
            box-shadow: 0 8px 32px rgba(153, 27, 27, 0.5);
        }

        .toast.error::before {
            content: '‚ùå';
            position: absolute;
            top: -10px;
            left: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-right: 10px;
        }

        .toast.error::after {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            margin-left: 10px;
        }

        .toast-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        }

        .toast-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #f59e0b;
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.3);
        }

        .toast-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
        }

        .toast-sticky {
            z-index: 10000;
            animation: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 24px 32px;
            border-radius: 16px;
            background: rgba(0,0,0,0.98);
            box-shadow: 0 12px 48px rgba(0,0,0,0.5);
            max-width: 450px;
            text-align: center;
            font-size: 15px;
            line-height: 1.5;
        }

        .toast-persistent {
            cursor: default;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Toast Close Button */
        .toast-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .toast-close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .toast-close-btn:active {
            transform: scale(0.95);
        }

        /* Top Modal Positioning */
        .login-modal-overlay.top-modal {
            z-index: 10001;
        }

        .login-modal.resent-modal {
            transform: translateY(-30px); /* Move up for top positioning */
        }
        @media (max-width: 768px) {
            .login-modal {
                padding: 24px;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="login-modal active" id="login-modal">
        <div class="login-tabs">
            <button class="tab-btn active" id="login-tab-btn" onclick="showLoginTab()">
                <i class="fa-solid fa-sign-in-alt"></i> Login
            </button>
            <button class="tab-btn" id="create-user-tab-btn" onclick="showCreateUserTab()">
                <i class="fa-solid fa-user-plus"></i> Create User
            </button>
        </div>
        
        <!-- Login Form -->
        <div class="tab-content active" id="login-tab">
            <h2><i class="fa-solid fa-user-shield"></i> Login</h2>
            
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="username">
                        <i class="fa-solid fa-user"></i> Username
                    </label>
                    <input type="text" id="username" name="username" required 
                           placeholder="Enter your username" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="password">
                        <i class="fa-solid fa-lock"></i> Password
                    </label>
                    <input type="password" id="password" name="password" required 
                           placeholder="Enter your password" autocomplete="current-password">
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="remember-me" name="remember-me">
                        Remember Me
                    </label>
                </div>
                
                <div class="login-buttons">
                    <button type="submit" class="login-btn-primary">
                        <i class="fa-solid fa-right-to-bracket"></i> Login
                    </button>
                    <button type="button" class="login-btn-secondary" onclick="window.location.href='campaign-counter.html'">
                        <i class="fa-solid fa-eye"></i> View as Guest
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Create User Form -->
        <div class="tab-content" id="create-user-tab">
            <h2><i class="fa-solid fa-user-plus"></i> Create New User</h2>
            
            <form class="login-form" onsubmit="handleCreateUser(event)">
                <div class="form-group">
                    <label for="new-username">
                        <i class="fa-solid fa-user"></i> Username
                    </label>
                    <input type="text" id="new-username" name="new-username" required 
                           placeholder="Choose a username" autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="new-password">
                        <i class="fa-solid fa-lock"></i> Password
                    </label>
                    <input type="password" id="new-password" name="new-password" required 
                           placeholder="Choose a password" autocomplete="new-password">
                </div>
                
                <div class="form-group">
                    <label for="confirm-password">
                        <i class="fa-solid fa-lock"></i> Confirm Password
                    </label>
                    <input type="password" id="confirm-password" name="confirm-password" required 
                           placeholder="Confirm your password" autocomplete="new-password">
                    <div id="password-error" style="color: #ef4444; font-size: 12px; margin-top: 5px; display: none;">
                        <i class="fa-solid fa-exclamation-circle"></i> Passwords do not match
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="phone-number">
                        <i class="fa-solid fa-phone"></i> Phone Number
                    </label>
                    <input type="tel" id="phone-number" name="phone-number" required 
                           placeholder="+62xxx-xxxx-xxxx, 08xxx-xxxx, or 087882884296" pattern="^(\+62|62|08)[0-9]{8,12}$">
                </div>
                
                <div class="form-group">
                    <label for="full-name">
                        <i class="fa-solid fa-id-card"></i> Full Name
                    </label>
                    <input type="text" id="full-name" name="full-name" required 
                           placeholder="Enter your full name">
                </div>
                
                <div class="login-buttons">
                    <button type="submit" class="login-btn-primary">
                        <i class="fa-solid fa-paper-plane"></i> Send Activation Code
                    </button>
                    <button type="button" class="login-btn-secondary" onclick="showLoginTab()">
                        <i class="fa-solid fa-arrow-left"></i> Back to Login
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- SMS Sent Confirmation Modal - REMOVED -->
    
    <!-- Activation Code Resent Modal -->
    <div class="login-modal-overlay top-modal" id="activation-resent-modal">
        <div class="login-modal resent-modal">
            <h2><i class="fa-solid fa-check-circle"></i> Code Resent</h2>
            
            <div class="form-group">
                <p style="color: rgba(255,255,255,0.8); font-size: 14px; text-align: center; margin-bottom: 20px;">
                    Activation code resent to your phone
                </p>
            </div>
            
            <div class="login-buttons">
                <button type="button" class="login-btn-primary" onclick="hideActivationResentModal()">
                    <i class="fa-solid fa-check"></i> OK
                </button>
            </div>
        </div>
    </div>
    
    <!-- Invalid Credentials Modal -->
    <div class="login-modal-overlay" id="invalid-credentials-modal">
        <div class="login-modal">
            <h2><i class="fa-solid fa-exclamation-triangle"></i> Invalid Credentials</h2>
            
            <div class="form-group">
                <p style="color: rgba(255,255,255,0.8); font-size: 14px; text-align: center; margin-bottom: 20px;">
                    The username or password you entered is incorrect. Please try again.
                </p>
                
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: white; font-size: 14px; margin-bottom: 10px;">
                        <i class="fa-solid fa-key"></i> Enter Activation Code
                    </h4>
                    <input type="text" id="direct-activation-code" name="direct-activation-code" 
                           placeholder="Enter 6-digit activation code" maxlength="6" pattern="[0-9]{6}" 
                           style="width: 100%; padding: 10px 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; background: rgba(255,255,255,0.1); color: white; font-size: 14px; margin-bottom: 10px;">
                    <button type="button" class="login-btn-secondary" onclick="handleDirectActivation()" style="width: 100%; padding: 8px 12px; font-size: 13px;">
                        <i class="fa-solid fa-check"></i> Activate Account
                    </button>
                </div>
            </div>
            
            <div class="login-buttons">
                <button type="button" class="login-btn-primary" onclick="tryAgainLogin()">
                    <i class="fa-solid fa-check"></i> Try Again
                </button>
                <button type="button" class="login-btn-secondary" onclick="createAccountFromInvalid()">
                    <i class="fa-solid fa-user-plus"></i> Create Account
                </button>
            </div>
        </div>
    </div>
    <div class="login-modal-overlay" id="activation-modal">
        <div class="login-modal">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;"><i class="fa-solid fa-mobile-alt"></i> SMS Activation</h2>
                <button type="button" onclick="hideActivationModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            
            <form class="login-form" onsubmit="handleActivation(event)">
                <div class="form-group">
                    <label for="activation-code">
                        <i class="fa-solid fa-key"></i> Activation Code
                    </label>
                    <input type="text" id="activation-code" name="activation-code" required 
                           placeholder="Enter 6-digit activation code" maxlength="6" pattern="[0-9]{6}">
                </div>
                
                <div class="form-group">
                    <p style="color: rgba(255,255,255,0.8); font-size: 14px; text-align: center;">
                        We've sent a 6-digit activation code to your phone number
                    </p>
                </div>
                
                <div class="login-buttons">
                    <button type="submit" class="login-btn-primary">
                        <i class="fa-solid fa-check"></i> Activate Account
                    </button>
                    <button type="button" class="login-btn-secondary" onclick="resendActivationCode()">
                        <i class="fa-solid fa-redo"></i> Resend Code
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="assets/js/auth-system.js"></script>
    <script>
        // Function definitions
        function showLoginTab() {
            document.getElementById('login-tab').classList.add('active');
            document.getElementById('create-user-tab').classList.remove('active');
            document.getElementById('login-tab-btn').classList.add('active');
            document.getElementById('create-user-tab-btn').classList.remove('active');
            document.getElementById('username').focus();
        }

        function showCreateUserTab() {
            document.getElementById('create-user-tab').classList.add('active');
            document.getElementById('login-tab').classList.remove('active');
            document.getElementById('create-user-tab-btn').classList.add('active');
            document.getElementById('login-tab-btn').classList.remove('active');
            document.getElementById('new-username').focus();
        }

        function showCreateUserForm() {
            document.getElementById('create-user-modal').classList.add('active');
        }

        function hideCreateUserForm() {
            document.getElementById('create-user-modal').classList.remove('active');
        }

        function showActivationModal() {
            document.getElementById('activation-modal').classList.add('active');
            
            // Hide any existing toast notifications to avoid interference
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => {
                if (toast && toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            });
            
            // Focus on activation code after a small delay
            setTimeout(() => {
                document.getElementById('activation-code').focus();
            }, 100);
        }

        function hideActivationModal() {
            document.getElementById('activation-modal').classList.remove('active');
        }

        function handleCreateUser(event) {
            event.preventDefault();
            
            const username = document.getElementById('new-username').value.trim();
            const password = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const phoneNumber = document.getElementById('phone-number').value.trim();
            const fullName = document.getElementById('full-name').value.trim();
            const passwordError = document.getElementById('password-error');
            
            // Hide error message initially
            passwordError.style.display = 'none';
            
            // Validation
            if (password.length < 6) {
                auth.showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                passwordError.style.display = 'block';
                return;
            }
            
            if (!phoneNumber || !phoneNumber.match(/^(\+62|62|08)[0-9]{8,12}$/)) {
                auth.showNotification('Please enter a valid Indonesian phone number (+62xxx-xxxx-xxxx, 08xxx-xxxx, or 087882884296)', 'error');
                return;
            }
            
            if (!fullName || fullName.length < 3) {
                auth.showNotification('Please enter your full name', 'error');
                return;
            }
            
            // Store user data in database
            const userData = {
                username: username,
                password: password, // In production, this should be hashed
                phoneNumber: phoneNumber,
                fullName: fullName,
                role: 'user', // Default role for new users
                status: 'active',
                level: 1,
                createdAt: new Date().toISOString()
            };
            
            // Save user to database
            auth.saveUser(userData);
            
            // User is now active - show success message
            auth.showNotification(`Account created successfully! Welcome ${fullName}. You can now login.`, 'success');
            
            // Redirect to login tab
            setTimeout(() => {
                showLoginTab();
            }, 2000);
            
            // Clear form
            document.getElementById('new-username').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            document.getElementById('phone-number').value = '';
            document.getElementById('full-name').value = '';
        }

        function handleActivation(event) {
            event.preventDefault();
            
            const activationCode = document.getElementById('activation-code').value.trim();
            
            // Validation
            if (!activationCode || activationCode.length !== 6) {
                // Show centered toast that doesn't auto-hide
                const errorToast = document.createElement('div');
                errorToast.className = 'toast toast-error toast-persistent';
                errorToast.textContent = 'Please enter a valid 6-digit activation code. Check your SMS and try again.';
                
                document.body.appendChild(errorToast);
                errorToast.offsetHeight; // Force reflow
                
                // Add close button to toast
                const closeBtn = document.createElement('button');
                closeBtn.innerHTML = '&times;';
                closeBtn.style.cssText = `
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 16px;
                    cursor: pointer;
                    padding: 4px;
                    border-radius: 50%;
                    width: 24px;
                    height: 24px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                
                closeBtn.onclick = () => {
                    // Remove immediately without animation for better UX
                    if (document.body.contains(errorToast)) {
                        document.body.removeChild(errorToast);
                    }
                };
                
                errorToast.appendChild(closeBtn);
                return;
            }
            
            // Simulate activation (in real app, this would verify with server)
            if (activationCode === '123456') { // Demo code
                auth.showNotification('Account activated successfully! Demo code "123456" used. You can now login.', 'success');
                hideActivationModal();
                
                // Redirect to login
                setTimeout(() => {
                    showLoginTab();
                }, 1000);
            } else {
                // Show centered toast that doesn't auto-hide
                const errorToast = document.createElement('div');
                errorToast.className = 'toast toast-error toast-persistent';
                errorToast.textContent = 'Invalid activation code. Please check your SMS and enter the correct 6-digit code.';
                
                document.body.appendChild(errorToast);
                errorToast.offsetHeight; // Force reflow
                
                // Add close button to toast
                const closeBtn = document.createElement('button');
                closeBtn.innerHTML = '&times;';
                closeBtn.style.cssText = `
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 16px;
                    cursor: pointer;
                    padding: 4px;
                    border-radius: 50%;
                    width: 24px;
                    height: 24px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                
                closeBtn.onclick = () => {
                    // Remove immediately without animation for better UX
                    if (document.body.contains(errorToast)) {
                        document.body.removeChild(errorToast);
                    }
                };
                
                errorToast.appendChild(closeBtn);
                
                // Shake animation
                const modal = document.querySelector('#activation-modal .login-modal');
                modal.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    modal.style.animation = '';
                }, 500);
            }
        }

        function showActivationResentModal() {
            document.getElementById('activation-resent-modal').classList.add('active');
        }

        function hideActivationResentModal() {
            document.getElementById('activation-resent-modal').classList.remove('active');
        }

        function handleDirectActivation() {
            const activationCode = document.getElementById('direct-activation-code').value.trim();
            
            if (!activationCode || activationCode.length !== 6) {
                auth.showNotification('Please enter a valid 6-digit activation code. Check your SMS and try again.', 'error');
                return;
            }
            
            // Simulate activation (in real app, this would verify with server)
            if (activationCode) { // Any valid 6-digit code works in production
                auth.showNotification('Account activated successfully! You can now login.', 'success');
                hideInvalidCredentialsModal();
                
                setTimeout(() => {
                    showLoginTab();
                }, 1000);
            } else {
                auth.showNotification('Invalid activation code. Please check your SMS and enter the correct 6-digit code.', 'error');
            }
            
            // Shake animation
            const modal = document.querySelector('#activation-modal .login-modal');
            modal.style.animation = 'shake 0.5s';
            setTimeout(() => {
                modal.style.animation = '';
            }, 500);
        }

        function resendActivationCode() {
            // Clear any existing activation code input
            document.getElementById('activation-code').value = '';
            
            // Show success notification
            auth.showNotification('Activation code resent to your phone', 'success');
            showActivationResentModal();
            
            // Simulate resend (in real app, this would call SMS service)
            setTimeout(() => {
                document.getElementById('activation-code').focus();
            }, 500);
        }

        function showInvalidCredentialsModal() {
            document.getElementById('invalid-credentials-modal').classList.add('active');
        }

        function hideInvalidCredentialsModal() {
            document.getElementById('invalid-credentials-modal').classList.remove('active');
            showCreateUserTab(); // Direct to create user tab instead of focusing username
        }

        function tryAgainLogin() {
            hideInvalidCredentialsModal();
            document.getElementById('username').focus(); // Focus on username for retry
        }

        function createAccountFromInvalid() {
            hideInvalidCredentialsModal();
            showCreateUserTab(); // Switch to create user tab
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('remember-me').checked;
            
            if (auth.login(username, password)) {
                // Redirect to campaign counter after successful login
                setTimeout(() => {
                    window.location.href = 'campaign-counter.html';
                }, 500);
            } else {
                // Show invalid credentials modal instead of notification
                showInvalidCredentialsModal();
                
                // Clear password field
                document.getElementById('password').value = '';
            }
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideCreateUserForm();
                hideInvalidCredentialsModal();
                hideActivationResentModal();
                // SMS activation modal can only be closed with X button
            }
        });

        // Close modal on overlay click
        const activationModal = document.getElementById('activation-modal');
        // Removed overlay click handler - SMS modal can only be closed with X button

        const invalidCredentialsModal = document.getElementById('invalid-credentials-modal');
        if (invalidCredentialsModal) {
            invalidCredentialsModal.addEventListener('click', (e) => {
                // Only close if clicking on the overlay (background), not buttons
                if (e.target === invalidCredentialsModal) {
                    hideInvalidCredentialsModal();
                }
            });
        }

        const activationResentModal = document.getElementById('activation-resent-modal');
        if (activationResentModal) {
            activationResentModal.addEventListener('click', (e) => {
                if (e.target.id === 'activation-resent-modal') {
                    hideActivationResentModal();
                }
            });
        }

        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);

        // Initialize auth system
        document.addEventListener('DOMContentLoaded', () => {
            // Auto redirect to campaign counter if already logged in
            if (auth.getCurrentUser()) {
                window.location.href = 'campaign-counter.html';
            }
            
            // Auto-focus username field
            document.getElementById('username').focus();
            
            // Real-time password validation
            const newPasswordInput = document.getElementById('new-password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            const passwordError = document.getElementById('password-error');
            
            function validatePasswords() {
                if (confirmPasswordInput.value && newPasswordInput.value !== confirmPasswordInput.value) {
                    passwordError.style.display = 'block';
                } else {
                    passwordError.style.display = 'none';
                }
            }
            
            newPasswordInput.addEventListener('input', validatePasswords);
            confirmPasswordInput.addEventListener('input', validatePasswords);
        });
    </script>
</body>
</html>
